---
title: "Random Forest"
output: html_notebook
---
##Random Forest Prediction Model

Open libraries.

```{r}
library("mlbench")
library("dplyr")
library("caret")
library("randomForest")
library("lattice")
library("ggplot2")
library("rpart")
library("e1071")
library("caret", lib.loc="/Library/Frameworks/R.framework/Versions/3.4/Resources/library")
library("stats")
library(relaimpo)
library(party)

```
Get a list of Variable names.

```{r}
Names <- names(dfNormDatAndFactor)
unlist(Names, recursive = TRUE, use.names = TRUE)
```

##Parrtitions created with 75% of data for training and 25% of data for testing.
```{r}
inTraining <- createDataPartition(dfNormDatAndFactor$Enrolling, p = 0.75, list = FALSE)
training <- dfNormDatAndFactor[inTraining, ]
testing <- dfNormDatAndFactor[-inTraining, ]
```

```{r}
training
```

```{r}
testing
```
##Run Random Forest Model with all variables.
```{r}
rfModel <- randomForest(Enrolling ~ Sex.F + Sex.M +Expel.N + Expel.Y+ First.Gen.N+ First.Gen.Y+Challenge.Tag.N + Challenge.Tag.Y+ Boettcher.Semi.N+ Boettcher.Semi.Y+ Boettcher.Final.N+Boettcher.Final.Y + Daniels.Semi.N+Daniels.Semi.Y+ Daniels.Final.N+ Daniels.Final.Y+ Harvey.App.N+ Harvey.App.Y + Harvey.Final.N+ Harvey.Final.Y+ FC.App.N+ FC.App.Y+  Thorson.App.N+ Thorson.App.Y+ Thorson.Admit.N +Thorson.Admit.Y+Summet.Participant.N+ Summet.Participant.Y + Mines.Medal.N+ Mines.Medal.Y+ SPS.N+ SPS.Y+ Veteran.N+ Veteran.Y+ Legacy.N +  Legacy.Y+ Athlete.N +  Athlete.N + Athlete.Y + State.CO +  State.Other  +  Citizenship.Foreign.National.International +Citizenship.International +  Citizenship.Missing+ Citizenship.U.S..Citizen+ Citizenship.U.S..Permanent.Resident.Green.Card.Holder+ Citizenship.Undocumented.DACA+ Ethnicity.American.Indian.or.Alaska.Native+  Ethnicity.Asian+ Ethnicity.Black.or.African.American+ Ethnicity.Hispanic.or.Latino + Ethnicity.Missing + Ethnicity.Multiracial +Ethnicity.Native.Hawaiian.or.Other.Pacific.Islander + Ethnicity.NotDeclared + Ethnicity.Unknown +Ethnicity.White+ Major.App.Applied.Mathematics...Statistics...Computational...Applied.Mathematics+ Major.App.Applied.Mathematics...Statistics...Statistics+ Major.App.Chemical.Engineering+ Major.App.Chemical.Engineering...Biological.Engineering.Specialty+ Major.App.Chemistry+  Major.App.Chemistry...Biochemistry.Specialty + Major.App.Chemistry...Environmental.Chemistry.Specialty + Major.App.Civil.Engineering + Major.App.Computer.Science + Major.App.Economics+ Major.App.Electrical.Engineering+ Major.App.Engineering.Physics+  Major.App.Environmental.Engineering+ Major.App.Geological.Engineering +  Major.App.Geophysical.Engineering +Major.App.Mechanical.Engineering +  Major.App.Metallurgical...Materials.Engineering + Major.App.Mining.Engineering +  Major.App.Missing + Major.App.Petroleum.Engineering+   Major.App.Undecided+ First.Contact.ACT +  First.Contact.Application + First.Contact.Athlete.Form + First.Contact.Campus.Visit + First.Contact.College.Fair + First.Contact.FUF+First.Contact.Girls.Lead.the.Way+First.Contact.GPA.Form + First.Contact.Inquiry.Form+First.Contact.Mailing+ First.Contact.Materials +  First.Contact.MEP+ First.Contact.Phone+ First.Contact.Preview.Mines+ First.Contact.Royall.Search+First.Contact.TOEFL+ First.Contact.SAT+ First.Visit.Campus.Tour+ First.Visit.Campus.Visit+ First.Visit.Class.Shadow +  First.Visit.Discover.Mines+ First.Visit.Discovery.Mines.in.Your.City+ First.Visit.Girls.Lead.the.Way+  First.Visit.Launch + First.Visit.Making.The.Connection + First.Visit.Meet.Me.at.Mines+ First.Visit.None+  First.Visit.Preview.Mines + First.Visit.Preview.Mines.In.Your.City + Sport.Men.s.Varsity.Baseball+  Sport.Men.s.Varsity.Basketball+  Sport.Men.s.Varsity.Football + Sport.Men.s.Varsity.Golf +Sport.Men.s.Varsity.Soccer+  Sport.Men.s.Varsity.Wrestling+  Sport.None+  Sport.Varsity.Swimming.Diving+ Sport.Varsity.Track.Field+Sport.Varsity.XCountry+  Sport.Women.s.Varsity.Basketball +  Sport.Women.s.Varsity.Soccer+  Sport.Women.s.Varsity.Softball + Sport.Women.s.Varsity.Volleyball+ App.Created.Days +  Age  + HS.GPA+ SATR.Converted +Review.OutsideActivity +Review.Leadership+Review.WorkExp+ Review.WorkEthic +Review.ExpDiversity +Review.DesireAttend +Review.Affinity+ Review.InnovEntrep+Review.Teamwork +Review.OverallFit + Logins.60Days+EventCount.All+EventCount.Admitted+EventCount.Campus, data =  training)
rfModel

```
```{r}
rfModel.prediction <- predict(rfModel, testing)
table(rfModel.prediction, testing$Enrolling)
```

To determine variable importance.
```{r}
imprfModel <-   importance(rfModel)
imprfModel
```
```{r}
#format((sort(imprfModel, decreasing=TRUE)), scientific=F)
#sort(imprfModel, decreasing=TRUE)  # relative importance
```
```{r}
dfimprfModel <-as.data.frame(imprfModel)
dfimprfModel
```


```{r}
confusionMatrix(table(rfModel.prediction, testing$Enrolling))
```

Plot of importance of Variabels.
```{r}
varImpPlot(rfModel,cex = .6, pt.cex = .7, color = "navy blue", gcolor = par("fg"), lcolor = "gray", main = "Variable Importance for Random Forest Model")
```
##Model with less variables
```{r}
rfModelLess <- randomForest(Enrolling ~ State.CO +  State.Other  +  Major.App.Mechanical.Engineering +  First.Contact.Application + First.Contact.Campus.Visit + First.Contact.FUF + First.Contact.Royall.Search+ First.Visit.Campus.Tour+ First.Visit.Campus.Visit+ First.Visit.Discover.Mines+ First.Visit.Launch + First.Visit.None+  First.Visit.Preview.Mines.In.Your.City + App.Created.Days +  Age  + HS.GPA+ SATR.Converted +Review.OutsideActivity +Review.Leadership+Review.WorkExp+ Review.WorkEthic +Review.ExpDiversity +Review.DesireAttend +Review.Affinity+ Review.InnovEntrep+Review.Teamwork +Review.OverallFit +Ethnicity.White +EventCount.All+EventCount.Admitted+EventCount.Campus, data =  training)
rfModelLess

```

```{r}
rfModelLess.prediction <- predict(rfModelLess, testing)
table(rfModelLess.prediction, testing$Enrolling)
```

To determine variable imortance.
```{r}
imprfModelLess <-   importance(rfModelLess)
#format(imprfModelLess, scientific=F)
imprfModelLess
```

```{r}
confusionMatrix(table(rfModelLess.prediction, testing$Enrolling))
```

##Model with top 25 variables
```{r}
rfModelTop25 <- randomForest(Enrolling ~ State.CO +  State.Other  +  First.Contact.Campus.Visit + First.Visit.Campus.Tour+ First.Visit.Campus.Visit+ First.Visit.Discover.Mines+ First.Visit.Launch + First.Visit.None+  First.Visit.Preview.Mines.In.Your.City + App.Created.Days +  Age  + HS.GPA+ SATR.Converted +Review.OutsideActivity +Review.Leadership+Review.WorkExp+ Review.WorkEthic +Review.ExpDiversity +Review.DesireAttend +Review.Affinity+ Review.InnovEntrep+Review.Teamwork +Review.OverallFit +EventCount.All+EventCount.Admitted+EventCount.Campus, data =  training)
rfModelTop25
```

```{r}
rfModelTop25.prediction <- predict(rfModelTop25, testing)
table(rfModelTop25.prediction, testing$Enrolling)
```

To determine variable imortance.
```{r}
imprfModelTop25 <-   importance(rfModelTop25)
#format(imprfModelLess, scientific=F)
imprfModelTop25
```

```{r}
confusionMatrix(table(rfModelTop25.prediction, testing$Enrolling))
```


```{r}
PredictionTop25 <- cbind(rfModelTop25.prediction,testing)
PredictionTop25
```











